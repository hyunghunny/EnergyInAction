(function(e){e.fn.extend({whatWeather:function(t){function r(t){var r=(new Date).getTime();var i=window.location.protocol+"//"+window.location.host;var s=window.location.pathname!="/"?window.location.pathname.split("/"):[],o="";for(var u=1;u<s.length-1;u++){o+="/"+s[u]}i=i+o;var a={uuid:r,uri:i,id:"",city:"",days:1,latitude:0,longitude:0,ip:false,geolocation:false,async:true,refresh:600,cache:false,dayAndNight:false,cssClass:"widget-1",typeTemp:"C",day:"Date",max:"Max",min:"Min",msgError:"Loading error",weekDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dateFormat:"{{dd}}/{{mm}}/{{yy}}",updateDateFormat:"{{DD}} {{M}} {{d}}, {{yy}}",template:0,templates:['<div class="{{cssClass}}"><div class="current"><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="climacon {{currentWeatherIcon}} pic"></span><span class="location">{{city}}, {{country}}</span></p></div><div class="next-days" style="display:none"><p><span class="day">{{day}}</span><span class="temp-max">{{max}}</span><span class="temp-min">{{min}}</span><span class="temp-pic"></span></p>{{#nextDays}}<p><span class="day">{{date}}</span><span class="temp-max">{{tempMax}}°</span><span class="temp-min">{{tempMin}}°</span><span class="climacon {{dayWeatherIcon}} temp-pic"></span></p>{{/nextDays}}</div></div>','<div class="{{cssClass}}"><div class="current"><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="climacon {{currentWeatherIcon}} pic"></span><span class="location">{{city}}, {{country}}</span></p></div></div>','<div class="{{cssClass}}"><div class="current"><p><span class="climacon {{currentWeatherIcon}} pic"></span></p><p><span class="temperature">{{currentCondition.temp}}°<sup>{{typeTemp}}</sup></span><span class="location">{{city}}</span></p></div></div>'],icons:{day:{"w-395":"flurries sun","w-392":"lightning sun","w-389":"lightning","w-386":"lightning sun","w-377":"hail","w-374":"hail sun","w-371":"fleurries sun","w-368":"snow sun","w-365":"sleet sun","w-362":"sleet sun","w-359":"downpour","w-356":"downpour sun","w-353":"showers sun","w-350":"hail","w-338":"fleurries","w-335":"fleurries sun","w-332":"fleurries","w-329":"fleurries","w-326":"snow sun","w-323":"snow sun","w-320":"snow","w-317":"hail","w-314":"hail","w-311":"hail","w-308":"rain","w-305":"rain sun","w-302":"rain","w-299":"rain sun","w-296":"drizzle sun","w-293":"drizzle","w-284":"hail","w-281":"hail","w-266":"drizzle","w-263":"drizzle sun","w-260":"flog sun","w-248":"flog sun","w-230":"snowflake","w-227":"snow","w-200":"lightning sun","w-185":"hail","w-182":"hail","w-179":"sleet sun","w-176":"drizzle sun","w-143":"haze sun","w-122":"cloud","w-119":"cloud","w-116":"cloud sun","w-113":"sun"},night:{"w-395":"fleurries moon","w-392":"lightning moon","w-389":"lightning","w-386":"lightning moon","w-377":"hail","w-374":"hail moon","w-371":"fleurries moon","w-368":"snow moon","w-365":"sleet moon","w-362":"sleet moon","w-359":"downpour","w-356":"downpour moon","w-353":"showers moon","w-350":"hail","w-338":"fleurries","w-335":"fleurries moon","w-332":"fleurries","w-329":"fleurries","w-326":"snow moon","w-323":"snow moon","w-320":"snow","w-317":"hail","w-314":"hail","w-311":"hail","w-308":"rain","w-305":"rain moon","w-302":"rain","w-299":"rain moon","w-296":"drizzle moon","w-293":"drizzle","w-284":"hail","w-281":"hail","w-266":"drizzle","w-263":"drizzle moon","w-260":"flog moon","w-248":"flog moon","w-230":"snowflake","w-227":"snow","w-200":"lightning moon","w-185":"hail","w-182":"hail","w-179":"sleet moon","w-176":"drizzle moon","w-143":"haze moon","w-122":"cloud","w-119":"cloud","w-116":"cloud moon","w-113":"moon"}},before:function(e,t){e.html('<div class="loading"></div>')},after:function(t,n){if(e(".next-days",t).length){e(".next-days",t).delay(500).toggle("fast")}},success:function(e,t,n){t.data.current_condition[0].temp=n.typeTemp.toLowerCase()=="c"?t.data.current_condition[0].temp_C:t.data.current_condition[0].temp_F;t.data.current_condition[0].dayOrNight="day";if(n.dayAndNight){t.data.current_condition[0].dayOrNight=v(t.data.current_condition[0].localObsDateTime)?"day":"night"}t.data.current_condition[0].localObsDateTime=Mustache.render(n.updateDateFormat,d(t.data.current_condition[0].localObsDateTime));var r=n.icons.day;for(var i=0;i<t.data.weather.length;i++){t.data.weather[i].dayWeatherIcon=r["w-"+t.data.weather[i].weatherCode];t.data.weather[i].dayWeatherPic=t.data.weather[i].weatherCode;t.data.weather[i].date=Mustache.render(n.dateFormat,p(t.data.weather[i].date));t.data.weather[i].tempMin=n.typeTemp.toLowerCase()=="c"?t.data.weather[i].tempMinC:t.data.weather[i].tempMinF;t.data.weather[i].tempMax=n.typeTemp.toLowerCase()=="c"?t.data.weather[i].tempMaxC:t.data.weather[i].tempMaxF}var s={day:n.day,max:n.max,min:n.min,cssClass:n.cssClass,typeTemp:n.typeTemp,currentCondition:t.data.current_condition[0],currentWeatherIcon:t.data.current_condition[0].dayOrNight=="night"?n.icons.night["w-"+t.data.current_condition[0].weatherCode]:n.icons.day["w-"+t.data.current_condition[0].weatherCode],city:t.data.nearest_area[0].areaName[0].value,country:t.data.nearest_area[0].country[0].value,nextDays:n.days>0?t.data.weather:null,options:n};if(window.localStorage&&n.refresh>0){localStorage.setItem(n.id?n.id:n.city,JSON.stringify(s));localStorage.setItem((n.id?n.id:n.city)+"-time",(new Date).getTime()+n.refresh*1e3)}l(e,s)},fail:function(e,t){e.html('<div class="error"><span>'+t.msgError+"</span></div>")}};var f=function(){var t=e(Mustache.render(a.templates[a.template],a));var i=window.localStorage&&a.refresh>0?(new Date).getTime()>window.localStorage.getItem((a.id?a.id:a.city)+"-time")?true:false:true;n.append(t);if(i){a.before(t);e.ajax({url:a.uri+"/get_weather.php",type:"GET",data:{city:encodeURIComponent(a.city),days:a.days,latitude:a.latitude,longitude:a.longitude,ip:a.ip,refresh:a.refresh,cache:a.cache,uuid:r},dataType:"json",async:a.async,beforeSend:a.before(t,a)}).done(function(e){if(e.data.error){a.msgError=e.data.error[0].msg;a.fail(t,a)}else{a.success(t,e,a)}}).fail(function(e){e.fail(t,e)})}else{l(t,JSON.parse(window.localStorage.getItem(a.id?a.id:a.city)))}};var l=function(t,n){tmp=e(Mustache.render(a.templates[a.template],n));t.replaceWith(tmp);a.after(tmp,a)};var c=function(e){a.latitude=e.coords.latitude;a.longitude=e.coords.longitude;f()};var h=function(e){var t="Error during the geolocation : ";switch(e.code){case e.TIMEOUT:t+="Timeout !";break;case e.PERMISSION_DENIED:t+="You have not given permission";break;case e.POSITION_UNAVAILABLE:t+="The position could not be determined";break;case e.UNKNOWN_ERROR:t+="Unknown error";break}a.ip=true;f()};var p=function(e){var t=new Date(e);if(e){tmp=e.split(/[^0-9]/);for(var n=0;n<5;n++){tmp[n]=tmp[n]!=undefined?tmp[n]:"00"}t=new Date(tmp[0],tmp[1]-1,tmp[2],tmp[3],tmp[4])}parse={a:""+(t.getHours()>12?"pm":"am"),A:""+(t.getHours()>12?"PM":"AM"),g:""+(t.getHours()>12?t.getHours()-12:t.getHours()),gg:""+(t.getHours()<10?"0"+t.getHours():t.getHours()>12?t.getHours()-12:t.getHours()),h:""+t.getHours(),hh:""+(t.getHours()<10?"0"+t.getHours():t.getHours()),i:""+t.getMinutes(),ii:""+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()),s:""+t.getSeconds(),ss:""+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds()),d:""+t.getDate(),dd:""+(t.getDate()<10?"0"+t.getDate():t.getDate()),m:""+(t.getMonth()+1),mm:""+(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1),y:""+(t.getYear()-100),yy:""+t.getFullYear(),DD:a.weekDays[t.getDay()],D:a.weekDays[t.getDay()].substring(0,3),MM:a.months[t.getMonth()],M:a.months[t.getMonth()].substring(0,3)};return parse};var d=function(e){var t=e.split(" ");var n=t[1].split(":");if(t[2]=="PM"){n[0]=n[0]==12?n[0]:parseInt(n[0])+12}return p(t[0]+"T"+n.join(":"))};var v=function(e){var t=e.split(" ");var e=t[1].split(":");if(t[2].indexOf("AM")!=-1&&parseInt(e[0])>5||t[2].indexOf("PM")!=-1&&parseInt(e[0])<8){return true}else{return false}};var m=function(t){e.extend(a,t);return this};m(t||{});if(navigator.geolocation&&a.geolocation){navigator.geolocation.getCurrentPosition(function(e){c(e)},function(e){h(e)})}else{f()}}var n=e(this);return this.each(function(){new r(t);return this})}})})(jQuery)